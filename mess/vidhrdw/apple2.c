/***************************************************************************

  vidhrdw/apple2.c

***************************************************************************/

#include "driver.h"
#include "vidhrdw/generic.h"
#include "includes/apple2.h"

/***************************************************************************/

static UINT32 old_a2;
static struct tilemap *text_tilemap;
static struct tilemap *dbltext_tilemap;
static struct tilemap *lores_tilemap;
static int text_videobase;
static int dbltext_videobase;
static int lores_videobase;
static UINT16 *artifact_map;
static UINT8 *lores_tiledata;
static UINT8 *text_tiledata;
static UINT8 *dbltext_tiledata;

#define	BLACK	0
#define PURPLE	3
#define	BLUE	6
#define ORANGE	9
#define GREEN	12
#define	WHITE	15

#define PROFILER_VIDEOTOUCH PROFILER_USER3

/***************************************************************************
  Fonts
***************************************************************************/

static UINT8 apple2_font[] =
{
	0x1c, 0x22, 0x2a, 0x3a, 0x1a, 0x02, 0x3c, 0x00, 	/* [0] */
	0x08, 0x14, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x00, 	/* [1] */
	0x1e, 0x22, 0x22, 0x1e, 0x22, 0x22, 0x1e, 0x00, 	/* [2] */
	0x1c, 0x22, 0x02, 0x02, 0x02, 0x22, 0x1c, 0x00, 	/* [3] */
	0x1e, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1e, 0x00, 	/* [4] */
	0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x3e, 0x00, 	/* [5] */
	0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x02, 0x00, 	/* [6] */
	0x3c, 0x02, 0x02, 0x02, 0x32, 0x22, 0x3c, 0x00, 	/* [7] */
	0x22, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x22, 0x00, 	/* [8] */
	0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00, 	/* [9] */
	0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x1c, 0x00, 	/* [10] */
	0x22, 0x12, 0x0a, 0x06, 0x0a, 0x12, 0x22, 0x00, 	/* [11] */
	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x3e, 0x00, 	/* [12] */
	0x22, 0x36, 0x2a, 0x2a, 0x22, 0x22, 0x22, 0x00, 	/* [13] */
	0x22, 0x22, 0x26, 0x2a, 0x32, 0x22, 0x22, 0x00, 	/* [14] */
	0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00, 	/* [15] */
	0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02, 0x02, 0x00, 	/* [16] */
	0x1c, 0x22, 0x22, 0x22, 0x2a, 0x12, 0x2c, 0x00, 	/* [17] */
	0x1e, 0x22, 0x22, 0x1e, 0x0a, 0x12, 0x22, 0x00, 	/* [18] */
	0x1c, 0x22, 0x02, 0x1c, 0x20, 0x22, 0x1c, 0x00, 	/* [19] */
	0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 	/* [20] */
	0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00, 	/* [21] */
	0x22, 0x22, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00, 	/* [22] */
	0x22, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x22, 0x00, 	/* [23] */
	0x22, 0x22, 0x14, 0x08, 0x14, 0x22, 0x22, 0x00, 	/* [24] */
	0x22, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x00, 	/* [25] */
	0x3e, 0x20, 0x10, 0x08, 0x04, 0x02, 0x3e, 0x00, 	/* [26] */
	0x3e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x3e, 0x00, 	/* [27] */
	0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00, 	/* [28] */
	0x3e, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3e, 0x00, 	/* [29] */
	0x00, 0x00, 0x08, 0x14, 0x22, 0x00, 0x00, 0x00, 	/* [30] */
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 	/* [31] */
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 	/* [32] */
	0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x08, 0x00, 	/* [33] */
	0x14, 0x14, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 	/* [34] */
	0x14, 0x14, 0x3e, 0x14, 0x3e, 0x14, 0x14, 0x00, 	/* [35] */
	0x08, 0x3c, 0x0a, 0x1c, 0x28, 0x1e, 0x08, 0x00, 	/* [36] */
	0x06, 0x26, 0x10, 0x08, 0x04, 0x32, 0x30, 0x00, 	/* [37] */
	0x04, 0x0a, 0x0a, 0x04, 0x2a, 0x12, 0x2c, 0x00, 	/* [38] */
	0x08, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 	/* [39] */
	0x08, 0x04, 0x02, 0x02, 0x02, 0x04, 0x08, 0x00, 	/* [40] */
	0x08, 0x10, 0x20, 0x20, 0x20, 0x10, 0x08, 0x00, 	/* [41] */
	0x08, 0x2a, 0x1c, 0x08, 0x1c, 0x2a, 0x08, 0x00, 	/* [42] */
	0x00, 0x08, 0x08, 0x3e, 0x08, 0x08, 0x00, 0x00, 	/* [43] */
	0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x04, 0x00, 	/* [44] */
	0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x00, 	/* [45] */
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 	/* [46] */
	0x00, 0x20, 0x10, 0x08, 0x04, 0x02, 0x00, 0x00, 	/* [47] */
	0x1c, 0x22, 0x32, 0x2a, 0x26, 0x22, 0x1c, 0x00, 	/* [48] */
	0x08, 0x0c, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00, 	/* [49] */
	0x1c, 0x22, 0x20, 0x18, 0x04, 0x02, 0x3e, 0x00, 	/* [50] */
	0x3e, 0x20, 0x10, 0x18, 0x20, 0x22, 0x1c, 0x00, 	/* [51] */
	0x10, 0x18, 0x14, 0x12, 0x3e, 0x10, 0x10, 0x00, 	/* [52] */
	0x3e, 0x02, 0x1e, 0x20, 0x20, 0x22, 0x1c, 0x00, 	/* [53] */
	0x38, 0x04, 0x02, 0x1e, 0x22, 0x22, 0x1c, 0x00, 	/* [54] */
	0x3e, 0x20, 0x10, 0x08, 0x04, 0x04, 0x04, 0x00, 	/* [55] */
	0x1c, 0x22, 0x22, 0x1c, 0x22, 0x22, 0x1c, 0x00, 	/* [56] */
	0x1c, 0x22, 0x22, 0x3c, 0x20, 0x10, 0x0e, 0x00, 	/* [57] */
	0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x00, 	/* [58] */
	0x00, 0x00, 0x08, 0x00, 0x08, 0x08, 0x04, 0x00, 	/* [59] */
	0x10, 0x08, 0x04, 0x02, 0x04, 0x08, 0x10, 0x00, 	/* [60] */
	0x00, 0x00, 0x3e, 0x00, 0x3e, 0x00, 0x00, 0x00, 	/* [61] */
	0x04, 0x08, 0x10, 0x20, 0x10, 0x08, 0x04, 0x00, 	/* [62] */
	0x1c, 0x22, 0x10, 0x08, 0x08, 0x00, 0x08, 0x00, 	/* [63] */
	0x1c, 0x22, 0x2a, 0x3a, 0x1a, 0x02, 0x3c, 0x00, 	/* [a2e 64] */
	0x08, 0x14, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x00, 	/* [a2e 65] */
	0x1e, 0x22, 0x22, 0x1e, 0x22, 0x22, 0x1e, 0x00, 	/* [a2e 66] */
	0x1c, 0x22, 0x02, 0x02, 0x02, 0x22, 0x1c, 0x00, 	/* [a2e 67] */
	0x1e, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1e, 0x00, 	/* [a2e 68] */
	0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x3e, 0x00, 	/* [a2e 69] */
	0x3e, 0x02, 0x02, 0x1e, 0x02, 0x02, 0x02, 0x00, 	/* [a2e 70] */
	0x3c, 0x02, 0x02, 0x02, 0x32, 0x22, 0x3c, 0x00, 	/* [a2e 71] */
	0x22, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x22, 0x00, 	/* [a2e 72] */
	0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00, 	/* [a2e 73] */
	0x20, 0x20, 0x20, 0x20, 0x20, 0x22, 0x1c, 0x00, 	/* [a2e 74] */
	0x22, 0x12, 0x0a, 0x06, 0x0a, 0x12, 0x22, 0x00, 	/* [a2e 75] */
	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x3e, 0x00, 	/* [a2e 76] */
	0x22, 0x36, 0x2a, 0x2a, 0x22, 0x22, 0x22, 0x00, 	/* [a2e 77] */
	0x22, 0x22, 0x26, 0x2a, 0x32, 0x22, 0x22, 0x00, 	/* [a2e 78] */
	0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00, 	/* [a2e 79] */
	0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02, 0x02, 0x00, 	/* [a2e 80] */
	0x1c, 0x22, 0x22, 0x22, 0x2a, 0x12, 0x2c, 0x00, 	/* [a2e 81] */
	0x1e, 0x22, 0x22, 0x1e, 0x0a, 0x12, 0x22, 0x00, 	/* [a2e 82] */
	0x1c, 0x22, 0x02, 0x1c, 0x20, 0x22, 0x1c, 0x00, 	/* [a2e 83] */
	0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 	/* [a2e 84] */
	0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1c, 0x00, 	/* [a2e 85] */
	0x22, 0x22, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00, 	/* [a2e 86] */
	0x22, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x22, 0x00, 	/* [a2e 87] */
	0x22, 0x22, 0x14, 0x08, 0x14, 0x22, 0x22, 0x00, 	/* [a2e 88] */
	0x22, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x00, 	/* [a2e 89] */
	0x3e, 0x20, 0x10, 0x08, 0x04, 0x02, 0x3e, 0x00, 	/* [a2e 90] */
	0x3e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x3e, 0x00, 	/* [a2e 91] */
	0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00, 	/* [a2e 92] */
	0x3e, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3e, 0x00, 	/* [a2e 93] */
	0x00, 0x00, 0x08, 0x14, 0x22, 0x00, 0x00, 0x00, 	/* [a2e 94] */
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 	/* [a2e 95] */
	0x04, 0x08, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 	/* [96] */
	0x00, 0x00, 0x1c, 0x20, 0x3c, 0x22, 0x3c, 0x00, 	/* [97] */
	0x02, 0x02, 0x1e, 0x22, 0x22, 0x22, 0x1e, 0x00, 	/* [98] */
	0x00, 0x00, 0x3c, 0x02, 0x02, 0x02, 0x3c, 0x00, 	/* [99] */
	0x20, 0x20, 0x3c, 0x22, 0x22, 0x22, 0x3c, 0x00, 	/* [100] */
	0x00, 0x00, 0x1c, 0x22, 0x3e, 0x02, 0x3c, 0x00, 	/* [101] */
	0x18, 0x24, 0x04, 0x1e, 0x04, 0x04, 0x04, 0x00, 	/* [102] */
	0x00, 0x00, 0x1c, 0x22, 0x22, 0x3c, 0x20, 0x1c, 	/* [103] */
	0x02, 0x02, 0x1e, 0x22, 0x22, 0x22, 0x22, 0x00, 	/* [104] */
	0x08, 0x00, 0x0c, 0x08, 0x08, 0x08, 0x1c, 0x00, 	/* [105] */
	0x10, 0x00, 0x18, 0x10, 0x10, 0x10, 0x12, 0x0c, 	/* [106] */
	0x02, 0x02, 0x22, 0x12, 0x0e, 0x12, 0x22, 0x00, 	/* [107] */
	0x0c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x00, 	/* [108] */
	0x00, 0x00, 0x36, 0x2a, 0x2a, 0x2a, 0x22, 0x00, 	/* [109] */
	0x00, 0x00, 0x1e, 0x22, 0x22, 0x22, 0x22, 0x00, 	/* [110] */
	0x00, 0x00, 0x1c, 0x22, 0x22, 0x22, 0x1c, 0x00, 	/* [111] */
	0x00, 0x00, 0x1e, 0x22, 0x22, 0x1e, 0x02, 0x02, 	/* [112] */
	0x00, 0x00, 0x3c, 0x22, 0x22, 0x3c, 0x20, 0x20, 	/* [113] */
	0x00, 0x00, 0x3a, 0x06, 0x02, 0x02, 0x02, 0x00, 	/* [114] */
	0x00, 0x00, 0x3c, 0x02, 0x1c, 0x20, 0x1e, 0x00, 	/* [115] */
	0x04, 0x04, 0x1e, 0x04, 0x04, 0x24, 0x18, 0x00, 	/* [116] */
	0x00, 0x00, 0x22, 0x22, 0x22, 0x32, 0x2c, 0x00, 	/* [117] */
	0x00, 0x00, 0x22, 0x22, 0x22, 0x14, 0x08, 0x00, 	/* [118] */
	0x00, 0x00, 0x22, 0x22, 0x2a, 0x2a, 0x36, 0x00, 	/* [119] */
	0x00, 0x00, 0x22, 0x14, 0x08, 0x14, 0x22, 0x00, 	/* [120] */
	0x00, 0x00, 0x22, 0x22, 0x22, 0x3c, 0x20, 0x1c, 	/* [121] */
	0x00, 0x00, 0x3e, 0x10, 0x08, 0x04, 0x3e, 0x00, 	/* [122] */
	0x38, 0x0c, 0x0c, 0x06, 0x0c, 0x0c, 0x38, 0x00, 	/* [123] */
	0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 	/* [124] */
	0x0e, 0x18, 0x18, 0x30, 0x18, 0x18, 0x0e, 0x00, 	/* [125] */
	0x2c, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 	/* [126] */
	0x00, 0x2a, 0x14, 0x2a, 0x14, 0x2a, 0x00, 0x00, 	/* [127] */
	0xe3, 0xdd, 0xd5, 0xc5, 0xe5, 0xfd, 0xc3, 0xff, 	/* [128] */
	0xf7, 0xeb, 0xdd, 0xdd, 0xc1, 0xdd, 0xdd, 0xff, 	/* [129] */
	0xe1, 0xdd, 0xdd, 0xe1, 0xdd, 0xdd, 0xe1, 0xff, 	/* [130] */
	0xe3, 0xdd, 0xfd, 0xfd, 0xfd, 0xdd, 0xe3, 0xff, 	/* [131] */
	0xe1, 0xdd, 0xdd, 0xdd, 0xdd, 0xdd, 0xe1, 0xff, 	/* [132] */
	0xc1, 0xfd, 0xfd, 0xe1, 0xfd, 0xfd, 0xc1, 0xff, 	/* [133] */
	0xc1, 0xfd, 0xfd, 0xe1, 0xfd, 0xfd, 0xfd, 0xff, 	/* [134] */
	0xc3, 0xfd, 0xfd, 0xfd, 0xcd, 0xdd, 0xc3, 0xff, 	/* [135] */
	0xdd, 0xdd, 0xdd, 0xc1, 0xdd, 0xdd, 0xdd, 0xff, 	/* [136] */
	0xe3, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xe3, 0xff, 	/* [137] */
	0xdf, 0xdf, 0xdf, 0xdf, 0xdf, 0xdd, 0xe3, 0xff, 	/* [138] */
	0xdd, 0xed, 0xf5, 0xf9, 0xf5, 0xed, 0xdd, 0xff, 	/* [139] */
	0xfd, 0xfd, 0xfd, 0xfd, 0xfd, 0xfd, 0xc1, 0xff, 	/* [140] */
	0xdd, 0xc9, 0xd5, 0xd5, 0xdd, 0xdd, 0xdd, 0xff, 	/* [141] */
	0xdd, 0xdd, 0xd9, 0xd5, 0xcd, 0xdd, 0xdd, 0xff, 	/* [142] */
	0xe3, 0xdd, 0xdd, 0xdd, 0xdd, 0xdd, 0xe3, 0xff, 	/* [143] */
	0xe1, 0xdd, 0xdd, 0xe1, 0xfd, 0xfd, 0xfd, 0xff, 	/* [144] */
	0xe3, 0xdd, 0xdd, 0xdd, 0xd5, 0xed, 0xd3, 0xff, 	/* [145] */
	0xe1, 0xdd, 0xdd, 0xe1, 0xf5, 0xed, 0xdd, 0xff, 	/* [146] */
	0xe3, 0xdd, 0xfd, 0xe3, 0xdf, 0xdd, 0xe3, 0xff, 	/* [147] */
	0xc1, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xff, 	/* [148] */
	0xdd, 0xdd, 0xdd, 0xdd, 0xdd, 0xdd, 0xe3, 0xff, 	/* [149] */
	0xdd, 0xdd, 0xdd, 0xdd, 0xdd, 0xeb, 0xf7, 0xff, 	/* [150] */
	0xdd, 0xdd, 0xdd, 0xd5, 0xd5, 0xc9, 0xdd, 0xff, 	/* [151] */
	0xdd, 0xdd, 0xeb, 0xf7, 0xeb, 0xdd, 0xdd, 0xff, 	/* [152] */
	0xdd, 0xdd, 0xeb, 0xf7, 0xf7, 0xf7, 0xf7, 0xff, 	/* [153] */
	0xc1, 0xdf, 0xef, 0xf7, 0xfb, 0xfd, 0xc1, 0xff, 	/* [154] */
	0xc1, 0xf9, 0xf9, 0xf9, 0xf9, 0xf9, 0xc1, 0xff, 	/* [155] */
	0xff, 0xfd, 0xfb, 0xf7, 0xef, 0xdf, 0xff, 0xff, 	/* [156] */
	0xc1, 0xcf, 0xcf, 0xcf, 0xcf, 0xcf, 0xc1, 0xff, 	/* [157] */
	0xff, 0xff, 0xf7, 0xeb, 0xdd, 0xff, 0xff, 0xff, 	/* [158] */
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 	/* [159] */
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 	/* [160] */
	0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xff, 0xf7, 0xff, 	/* [161] */
	0xeb, 0xeb, 0xeb, 0xff, 0xff, 0xff, 0xff, 0xff, 	/* [162] */
	0xeb, 0xeb, 0xc1, 0xeb, 0xc1, 0xeb, 0xeb, 0xff, 	/* [163] */
	0xf7, 0xc3, 0xf5, 0xe3, 0xd7, 0xe1, 0xf7, 0xff, 	/* [164] */
	0xf9, 0xd9, 0xef, 0xf7, 0xfb, 0xcd, 0xcf, 0xff, 	/* [165] */
	0xfb, 0xf5, 0xf5, 0xfb, 0xd5, 0xed, 0xd3, 0xff, 	/* [166] */
	0xf7, 0xf7, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 	/* [167] */
	0xf7, 0xfb, 0xfd, 0xfd, 0xfd, 0xfb, 0xf7, 0xff, 	/* [168] */
	0xf7, 0xef, 0xdf, 0xdf, 0xdf, 0xef, 0xf7, 0xff, 	/* [169] */
	0xf7, 0xd5, 0xe3, 0xf7, 0xe3, 0xd5, 0xf7, 0xff, 	/* [170] */
	0xff, 0xf7, 0xf7, 0xc1, 0xf7, 0xf7, 0xff, 0xff, 	/* [171] */
	0xff, 0xff, 0xff, 0xff, 0xf7, 0xf7, 0xfb, 0xff, 	/* [172] */
	0xff, 0xff, 0xff, 0xc1, 0xff, 0xff, 0xff, 0xff, 	/* [173] */
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf7, 0xff, 	/* [174] */
	0xff, 0xdf, 0xef, 0xf7, 0xfb, 0xfd, 0xff, 0xff, 	/* [175] */
	0xe3, 0xdd, 0xcd, 0xd5, 0xd9, 0xdd, 0xe3, 0xff, 	/* [176] */
	0xf7, 0xf3, 0xf7, 0xf7, 0xf7, 0xf7, 0xe3, 0xff, 	/* [177] */
	0xe3, 0xdd, 0xdf, 0xe7, 0xfb, 0xfd, 0xc1, 0xff, 	/* [178] */
	0xc1, 0xdf, 0xef, 0xe7, 0xdf, 0xdd, 0xe3, 0xff, 	/* [179] */
	0xef, 0xe7, 0xeb, 0xed, 0xc1, 0xef, 0xef, 0xff, 	/* [180] */
	0xc1, 0xfd, 0xe1, 0xdf, 0xdf, 0xdd, 0xe3, 0xff, 	/* [181] */
	0xc7, 0xfb, 0xfd, 0xe1, 0xdd, 0xdd, 0xe3, 0xff, 	/* [182] */
	0xc1, 0xdf, 0xef, 0xf7, 0xfb, 0xfb, 0xfb, 0xff, 	/* [183] */
	0xe3, 0xdd, 0xdd, 0xe3, 0xdd, 0xdd, 0xe3, 0xff, 	/* [184] */
	0xe3, 0xdd, 0xdd, 0xc3, 0xdf, 0xef, 0xf1, 0xff, 	/* [185] */
	0xff, 0xff, 0xf7, 0xff, 0xf7, 0xff, 0xff, 0xff, 	/* [186] */
	0xff, 0xff, 0xf7, 0xff, 0xf7, 0xf7, 0xfb, 0xff, 	/* [187] */
	0xef, 0xf7, 0xfb, 0xfd, 0xfb, 0xf7, 0xef, 0xff, 	/* [188] */
	0xff, 0xff, 0xc1, 0xff, 0xc1, 0xff, 0xff, 0xff, 	/* [189] */
	0xfb, 0xf7, 0xef, 0xdf, 0xef, 0xf7, 0xfb, 0xff, 	/* [190] */
	0xe3, 0xdd, 0xef, 0xf7, 0xf7, 0xff, 0xf7, 0xff, 	/* [191] */
	0xe3, 0xdd, 0xd5, 0xc5, 0xe5, 0xfd, 0xc3, 0xff, 	/* [192] */
	0xf7, 0xeb, 0xdd, 0xdd, 0xc1, 0xdd, 0xdd, 0xff, 	/* [193] */
	0xe1, 0xdd, 0xdd, 0xe1, 0xdd, 0xdd, 0xe1, 0xff, 	/* [194] */
	0xe3, 0xdd, 0xfd, 0xfd, 0xfd, 0xdd, 0xe3, 0xff, 	/* [195] */
	0xe1, 0xdd, 0xdd, 0xdd, 0xdd, 0xdd, 0xe1, 0xff, 	/* [196] */
	0xc1, 0xfd, 0xfd, 0xe1, 0xfd, 0xfd, 0xc1, 0xff, 	/* [197] */
	0xc1, 0xfd, 0xfd, 0xe1, 0xfd, 0xfd, 0xfd, 0xff, 	/* [198] */
	0xc3, 0xfd, 0xfd, 0xfd, 0xcd, 0xdd, 0xc3, 0xff, 	/* [199] */
	0xdd, 0xdd, 0xdd, 0xc1, 0xdd, 0xdd, 0xdd, 0xff, 	/* [200] */
	0xe3, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xe3, 0xff, 	/* [201] */
	0xdf, 0xdf, 0xdf, 0xdf, 0xdf, 0xdd, 0xe3, 0xff, 	/* [202] */
	0xdd, 0xed, 0xf5, 0xf9, 0xf5, 0xed, 0xdd, 0xff, 	/* [203] */
	0xfd, 0xfd, 0xfd, 0xfd, 0xfd, 0xfd, 0xc1, 0xff, 	/* [204] */
	0xdd, 0xc9, 0xd5, 0xd5, 0xdd, 0xdd, 0xdd, 0xff, 	/* [205] */
	0xdd, 0xdd, 0xd9, 0xd5, 0xcd, 0xdd, 0xdd, 0xff, 	/* [206] */
	0xe3, 0xdd, 0xdd, 0xdd, 0xdd, 0xdd, 0xe3, 0xff, 	/* [207] */
	0xe1, 0xdd, 0xdd, 0xe1, 0xfd, 0xfd, 0xfd, 0xff, 	/* [208] */
	0xe3, 0xdd, 0xdd, 0xdd, 0xd5, 0xed, 0xd3, 0xff, 	/* [209] */
	0xe1, 0xdd, 0xdd, 0xe1, 0xf5, 0xed, 0xdd, 0xff, 	/* [210] */
	0xe3, 0xdd, 0xfd, 0xe3, 0xdf, 0xdd, 0xe3, 0xff, 	/* [211] */
	0xc1, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xff, 	/* [212] */
	0xdd, 0xdd, 0xdd, 0xdd, 0xdd, 0xdd, 0xe3, 0xff, 	/* [213] */
	0xdd, 0xdd, 0xdd, 0xdd, 0xdd, 0xeb, 0xf7, 0xff, 	/* [214] */
	0xdd, 0xdd, 0xdd, 0xd5, 0xd5, 0xc9, 0xdd, 0xff, 	/* [215] */
	0xdd, 0xdd, 0xeb, 0xf7, 0xeb, 0xdd, 0xdd, 0xff, 	/* [216] */
	0xdd, 0xdd, 0xeb, 0xf7, 0xf7, 0xf7, 0xf7, 0xff, 	/* [217] */
	0xc1, 0xdf, 0xef, 0xf7, 0xfb, 0xfd, 0xc1, 0xff, 	/* [218] */
	0xc1, 0xf9, 0xf9, 0xf9, 0xf9, 0xf9, 0xc1, 0xff, 	/* [219] */
	0xff, 0xfd, 0xfb, 0xf7, 0xef, 0xdf, 0xff, 0xff, 	/* [220] */
	0xc1, 0xcf, 0xcf, 0xcf, 0xcf, 0xcf, 0xc1, 0xff, 	/* [221] */
	0xff, 0xff, 0xf7, 0xeb, 0xdd, 0xff, 0xff, 0xff, 	/* [222] */
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 	/* [223] */
	0xfb, 0xf7, 0xef, 0xff, 0xff, 0xff, 0xff, 0xff, 	/* [224] */
	0xff, 0xff, 0xe3, 0xdf, 0xc3, 0xdd, 0xc3, 0xff, 	/* [225] */
	0xfd, 0xfd, 0xe1, 0xdd, 0xdd, 0xdd, 0xe1, 0xff, 	/* [226] */
	0xff, 0xff, 0xc3, 0xfd, 0xfd, 0xfd, 0xc3, 0xff, 	/* [227] */
	0xdf, 0xdf, 0xc3, 0xdd, 0xdd, 0xdd, 0xc3, 0xff, 	/* [228] */
	0xff, 0xff, 0xe3, 0xdd, 0xc1, 0xfd, 0xc3, 0xff, 	/* [229] */
	0xe7, 0xdb, 0xfb, 0xe1, 0xfb, 0xfb, 0xfb, 0xff, 	/* [230] */
	0xff, 0xff, 0xe3, 0xdd, 0xdd, 0xc3, 0xdf, 0xe3, 	/* [231] */
	0xfd, 0xfd, 0xe1, 0xdd, 0xdd, 0xdd, 0xdd, 0xff, 	/* [232] */
	0xf7, 0xff, 0xf3, 0xf7, 0xf7, 0xf7, 0xe3, 0xff, 	/* [233] */
	0xef, 0xff, 0xe7, 0xef, 0xef, 0xef, 0xed, 0xf3, 	/* [234] */
	0xfd, 0xfd, 0xdd, 0xed, 0xf1, 0xed, 0xdd, 0xff, 	/* [235] */
	0xf3, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xe3, 0xff, 	/* [236] */
	0xff, 0xff, 0xc9, 0xd5, 0xd5, 0xd5, 0xdd, 0xff, 	/* [237] */
	0xff, 0xff, 0xe1, 0xdd, 0xdd, 0xdd, 0xdd, 0xff, 	/* [238] */
	0xff, 0xff, 0xe3, 0xdd, 0xdd, 0xdd, 0xe3, 0xff, 	/* [239] */
	0xff, 0xff, 0xe1, 0xdd, 0xdd, 0xe1, 0xfd, 0xfd, 	/* [240] */
	0xff, 0xff, 0xc3, 0xdd, 0xdd, 0xc3, 0xdf, 0xdf, 	/* [241] */
	0xff, 0xff, 0xc5, 0xf9, 0xfd, 0xfd, 0xfd, 0xff, 	/* [242] */
	0xff, 0xff, 0xc3, 0xfd, 0xe3, 0xdf, 0xe1, 0xff, 	/* [243] */
	0xfb, 0xfb, 0xe1, 0xfb, 0xfb, 0xdb, 0xe7, 0xff, 	/* [244] */
	0xff, 0xff, 0xdd, 0xdd, 0xdd, 0xcd, 0xd3, 0xff, 	/* [245] */
	0xff, 0xff, 0xdd, 0xdd, 0xdd, 0xeb, 0xf7, 0xff, 	/* [246] */
	0xff, 0xff, 0xdd, 0xdd, 0xd5, 0xd5, 0xc9, 0xff, 	/* [247] */
	0xff, 0xff, 0xdd, 0xeb, 0xf7, 0xeb, 0xdd, 0xff, 	/* [248] */
	0xff, 0xff, 0xdd, 0xdd, 0xdd, 0xc3, 0xdf, 0xe3, 	/* [249] */
	0xff, 0xff, 0xc1, 0xef, 0xf7, 0xfb, 0xc1, 0xff, 	/* [250] */
	0xc7, 0xf3, 0xf3, 0xf9, 0xf3, 0xf3, 0xc7, 0xff, 	/* [251] */
	0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 0xf7, 	/* [252] */
	0xf1, 0xe7, 0xe7, 0xcf, 0xe7, 0xe7, 0xf1, 0xff, 	/* [253] */
	0xd3, 0xe5, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 	/* [254] */
	0xff, 0xd5, 0xeb, 0xd5, 0xeb, 0xd5, 0xff, 0xff,	 	/* [255] */
	0xef, 0xf7, 0xc9, 0x80, 0xc0, 0xc0, 0x81, 0xc9, 	/* [a2c 64] */
	0xef, 0xf7, 0xc9, 0xbe, 0xde, 0xde, 0xb5, 0xc9, 	/* [a2c 65] */
	0xff, 0xff, 0xfd, 0xf9, 0xf1, 0xe1, 0xc9, 0xbd, 	/* [a2c 66] */
	0x80, 0xdd, 0xeb, 0xf7, 0xf7, 0xeb, 0xd5, 0x80, 	/* [a2c 67] */
	0xff, 0xbf, 0xdf, 0xee, 0xf5, 0xfb, 0xfb, 0xff, 	/* [a2c 68] */
	0x80, 0xc0, 0xa0, 0x93, 0x8a, 0x84, 0x84, 0x80, 	/* [a2c 69] */
	0x8f, 0x9f, 0x81, 0xce, 0x86, 0xcf, 0xc0, 0xfd, 	/* [a2c 70] */
	0xff, 0xe7, 0xf8, 0xff, 0xf8, 0xf3, 0xf7, 0x8f, 	/* [a2c 71] */
	0xf7, 0xfb, 0xfd, 0x80, 0xfd, 0xfb, 0xf7, 0xff, 	/* [a2c 72] */
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xd5, 	/* [a2c 73] */
	0xf7, 0xf7, 0xf7, 0xf7, 0xb6, 0xd5, 0xe3, 0xf7, 	/* [a2c 74] */
	0xf7, 0xe3, 0xd5, 0xb6, 0xf7, 0xf7, 0xf7, 0xf7, 	/* [a2c 75] */
	0x80, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 	/* [a2c 76] */
	0xbf, 0xbf, 0xbf, 0xbb, 0xb9, 0x80, 0xf9, 0xfb, 	/* [a2c 77] */
	0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 	/* [a2c 78] */
	0xec, 0xe7, 0xe3, 0x81, 0xe3, 0xe7, 0xef, 0x90, 	/* [a2c 79] */
	0x9b, 0xf3, 0xe3, 0xc0, 0xe3, 0xf3, 0xfb, 0x84, 	/* [a2c 80] */
	0xbf, 0xb7, 0xf7, 0x80, 0xc1, 0xe3, 0xb7, 0xbf, 	/* [a2c 81] */
	0xbf, 0xb7, 0xe3, 0xc1, 0x80, 0xf7, 0xb7, 0xbf, 	/* [a2c 82] */
	0xff, 0xff, 0xff, 0x80, 0xff, 0xff, 0xff, 0xff, 	/* [a2c 83] */
	0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0x80, 	/* [a2c 84] */
	0xf7, 0xef, 0xdf, 0x80, 0xdf, 0xef, 0xf7, 0xff, 	/* [a2c 85] */
	0xd5, 0xaa, 0xd5, 0xaa, 0xd5, 0xaa, 0xd5, 0xaa, 	/* [a2c 86] */
	0xaa, 0xd5, 0xaa, 0xd5, 0xaa, 0xd5, 0xaa, 0xd5, 	/* [a2c 87] */
	0xff, 0xc1, 0xbe, 0xfe, 0xfe, 0xfe, 0x80, 0xff, 	/* [a2c 88] */
	0xff, 0xff, 0xc0, 0xbf, 0xbf, 0xbf, 0x80, 0xff, 	/* [a2c 89] */
	0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 0xbf, 	/* [a2c 90] */
	0xf7, 0xe3, 0xc1, 0x80, 0xc1, 0xe3, 0xf7, 0xff, 	/* [a2c 91] */
	0x80, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 	/* [a2c 92] */
	0xeb, 0xeb, 0x88, 0xff, 0x88, 0xeb, 0xeb, 0xff, 	/* [a2c 93] */
	0x80, 0xbf, 0xbf, 0xb3, 0xb3, 0xbf, 0xbf, 0x80, 	/* [a2c 94] */
	0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe  	/* [a2c 95] */
};

/***************************************************************************
  helpers
***************************************************************************/

static void apple2_draw_tilemap(struct mame_bitmap *bitmap, const struct rectangle *cliprect,
	int beginrow, int endrow, struct tilemap *tm, int raw_videobase, int *tm_videobase)
{
	struct rectangle new_cliprect;

	new_cliprect = *cliprect;

	if (new_cliprect.min_y < beginrow)
		new_cliprect.min_y = beginrow;
	if (new_cliprect.max_y > endrow)
		new_cliprect.max_y = endrow;
	if (new_cliprect.min_y > new_cliprect.max_y)
		return;

	if (a2 & VAR_RAMRD)
		raw_videobase += 0x10000;

	if (raw_videobase != *tm_videobase)
	{
		*tm_videobase = raw_videobase;
		tilemap_mark_all_tiles_dirty(tm);
	}
	tilemap_draw(bitmap, &new_cliprect, tm, 0, 0);
}

/***************************************************************************
  text
***************************************************************************/

static void apple2_generaltext_gettileinfo(int memory_offset, const UINT8 *tiledata, int videobase, int width)
{
	static pen_t pal_data[2] = { 0, 15 };
	int code = mess_ram[memory_offset + videobase];
	tile_info.tile_number = code;
	tile_info.pen_data = tiledata + (code * width * 8);
	tile_info.pal_data = pal_data;
	tile_info.pen_usage = 0;
	tile_info.flags = 0;
}

static void apple2_text_gettileinfo(int memory_offset)
{
	apple2_generaltext_gettileinfo(memory_offset, text_tiledata, text_videobase, 14);
}

static void apple2_dbltext_gettileinfo(int memory_offset)
{
	apple2_generaltext_gettileinfo(memory_offset, dbltext_tiledata, dbltext_videobase, 7);
}

static UINT32 apple2_text_getmemoryoffset(UINT32 col, UINT32 row, UINT32 num_cols, UINT32 num_rows)
{
	/* Special Apple II addressing.  Gotta love it. */
	return (((row & 0x07) << 7) | ((row & 0x18) * 5 + col));
}

static UINT32 apple2_dbltext_getmemoryoffset(UINT32 col, UINT32 row, UINT32 num_cols, UINT32 num_rows)
{
	return apple2_text_getmemoryoffset(col / 2, row, num_cols / 2, num_rows) + ((col % 2) ? 0x00000 : 0x10000);
}

static void apple2_text_draw(struct mame_bitmap *bitmap, const struct rectangle *cliprect, int page, int beginrow, int endrow)
{
	if (a2 & VAR_80COL)
		apple2_draw_tilemap(bitmap, cliprect, beginrow, endrow, dbltext_tilemap, page ? 0x800 : 0x400, &dbltext_videobase);
	else
		apple2_draw_tilemap(bitmap, cliprect, beginrow, endrow, text_tilemap, page ? 0x800 : 0x400, &text_videobase);
}

/***************************************************************************
  low resolution graphics
***************************************************************************/

static void apple2_lores_gettileinfo(int memory_offset)
{
	static pen_t pal_data[2];
	int ch;

	tile_info.tile_number = 0;
	tile_info.pen_data = lores_tiledata;
	tile_info.pal_data = pal_data;
	tile_info.pen_usage = 0;
	tile_info.flags = 0;

	ch = mess_ram[lores_videobase + memory_offset];
	pal_data[0] = (ch >> 0) & 0x0f;
	pal_data[1] = (ch >> 4) & 0x0f;
}

static void apple2_lores_draw(struct mame_bitmap *bitmap, const struct rectangle *cliprect, int page, int beginrow, int endrow)
{
	apple2_draw_tilemap(bitmap, cliprect, beginrow, endrow, lores_tilemap, page ? 0x800 : 0x400, &lores_videobase);
}

/***************************************************************************
  high resolution graphics
***************************************************************************/

static UINT32 apple2_hires_getmemoryoffset(UINT32 col, UINT32 row, UINT32 num_cols, UINT32 num_rows)
{
	/* Special Apple II addressing.  Gotta love it. */
	return apple2_text_getmemoryoffset(col, row / 8, num_cols, num_rows) | ((row & 7) << 10);
}

struct drawtask_params
{
	struct mame_bitmap *bitmap;
	UINT8 *vram;
	int beginrow;
	int rowcount;
};

static void apple2_hires_draw_task(void *param, int task_num, int task_count)
{
	struct drawtask_params *dtparams;
	struct mame_bitmap *bitmap;
	UINT8 *vram;
	int beginrow;
	int endrow;
	int row, col, b;
	int offset;
	UINT8 vram_row[42];
	UINT16 v;
	UINT16 *p;
	UINT32 w;
	UINT16 *artifact_map_ptr;

	dtparams = (struct drawtask_params *) param;

	bitmap = dtparams->bitmap;
	vram = dtparams->vram;
	beginrow	= dtparams->beginrow + (dtparams->rowcount * task_num     / task_count);
	endrow		= dtparams->beginrow + (dtparams->rowcount * (task_num+1) / task_count) - 1;

	vram_row[0] = 0;
	vram_row[41] = 0;

	for (row = beginrow; row <= endrow; row++)
	{
		for (col = 0; col < 40; col++)
		{
			offset = apple2_hires_getmemoryoffset(col, row, 0, 0);
			vram_row[1+col] = vram[offset];
		}

		p = (UINT16 *) bitmap->line[row];

		for (col = 0; col < 40; col++)
		{
			w =		(((UINT32) vram_row[col+0] & 0x7f) <<  0)
				|	(((UINT32) vram_row[col+1] & 0x7f) <<  7)
				|	(((UINT32) vram_row[col+2] & 0x7f) << 14);

			artifact_map_ptr = &artifact_map[((vram_row[col+1] & 0x80) >> 7) * 16];
			
			for (b = 0; b < 7; b++)
			{
				v = artifact_map_ptr[((w >> (b + 7-1)) & 0x07) | (((b ^ col) & 0x01) << 3)];
				*(p++) = v;
				*(p++) = v;
			}
		}
	}
}

static void apple2_hires_draw(struct mame_bitmap *bitmap, const struct rectangle *cliprect, int page, int beginrow, int endrow)
{
	struct drawtask_params dtparams;

	if (beginrow < cliprect->min_y)
		beginrow = cliprect->min_y;
	if (endrow > cliprect->max_y)
		endrow = cliprect->max_y;
	if (endrow < beginrow)
		return;

	dtparams.vram = mess_ram + (page ? 0x4000 : 0x2000);
	if (a2 & VAR_RAMRD)
		dtparams.vram += 0x10000;

	dtparams.bitmap = bitmap;
	dtparams.beginrow = beginrow;
	dtparams.rowcount = (endrow + 1) - beginrow;

	osd_parallelize(apple2_hires_draw_task, &dtparams, dtparams.rowcount);
}

/***************************************************************************
  video core
***************************************************************************/

static int video_start_apple_common(int is_apple2c)
{
	int i, j, k;
	UINT16 c;
	int code;
	UINT8 *fontchar;
	UINT8 b, p;

	static UINT16 artifact_color_table[] =
	{
		BLACK,	PURPLE,	GREEN,	WHITE,
		BLACK,	BLUE,	ORANGE,	WHITE
	};

	text_tilemap = tilemap_create(
		apple2_text_gettileinfo,
		apple2_text_getmemoryoffset,
		TILEMAP_OPAQUE,
		7*2, 8,
		40, 24);

	dbltext_tilemap = tilemap_create(
		apple2_dbltext_gettileinfo,
		apple2_dbltext_getmemoryoffset,
		TILEMAP_OPAQUE,
		7, 8,
		80, 24);

	lores_tilemap = tilemap_create(
		apple2_lores_gettileinfo,
		apple2_text_getmemoryoffset,
		TILEMAP_OPAQUE,
		14, 8,
		40, 24);

	/* 2^3 dependent pixels * 2 color sets * 2 offsets */
	artifact_map = auto_malloc(sizeof(UINT16) * 8 * 2 * 2);

	/* 14x8 */
	lores_tiledata = auto_malloc(sizeof(UINT8) * 14 * 8);

	/* 14x8x256 */
	text_tiledata = auto_malloc(sizeof(UINT8) * 14 * 8 * 256);

	/* 14x8x256 */
	dbltext_tiledata = auto_malloc(sizeof(UINT8) * 7 * 8 * 256);

	if (!text_tilemap || !lores_tilemap || !text_tiledata || !dbltext_tiledata || !artifact_map)
		return 1;
	
	/* build lores_tiledata */
	memset(lores_tiledata + 0*14, 0, 4*14);
	memset(lores_tiledata + 4*14, 1, 4*14);

	/* build text_tiledata and dbltext_tiledata */
	for (i = 0; i < 256; i++)
	{
		code = i;
		if (is_apple2c && (code >= 64) && (code <= 95))
			code += 256-64;

		fontchar = apple2_font + (code * 8);
		for (j = 0; j < 8; j++)
		{
			b = fontchar[j];
			for (k = 0; k < 7; k++)
			{
				p = Machine->pens[(b & (1 << k)) ? 0 : 1];
				text_tiledata[i*14*8 + j*14 + (k*2+0)] = p;
				text_tiledata[i*14*8 + j*14 + (k*2+1)] = p;
				dbltext_tiledata[i*7*8 + j*7 + k] = p;
			}
		}
	}

	/* build artifact map */
	for (i = 0; i < 8; i++)
	{
		for (j = 0; j < 2; j++)
		{
			if (i & 0x02)
			{
				if ((i & 0x05) != 0)
					c = 3;
				else
					c = j ? 2 : 1;
			}
			else
			{
				if ((i & 0x05) == 0x05)
					c = j ? 1 : 2;
				else
					c = 0;
			}
			artifact_map[ 0 + j*8 + i] = artifact_color_table[c];
			artifact_map[16 + j*8 + i] = artifact_color_table[c+4];
		}
	}

	memset(&old_a2, 0, sizeof(old_a2));
	text_videobase = lores_videobase = 0;
	return 0;
}

VIDEO_START( apple2e )
{
	return video_start_apple_common(FALSE);
}

VIDEO_START( apple2c )
{
	return video_start_apple_common(TRUE);
}

#define A2VAR_MASK		(VAR_TEXT | VAR_MIXED | VAR_HIRES | VAR_80COL | VAR_PAGE2)

VIDEO_UPDATE( apple2 )
{
	int page;

	page = (a2 & VAR_PAGE2) ? 1 : 0;

	if ((a2 & A2VAR_MASK) != old_a2)
	{
		old_a2 = a2 & A2VAR_MASK;
		tilemap_mark_all_tiles_dirty(text_tilemap);
		tilemap_mark_all_tiles_dirty(dbltext_tilemap);
		tilemap_mark_all_tiles_dirty(lores_tilemap);
	}

	if (a2 & VAR_TEXT)
	{
		apple2_text_draw(bitmap, cliprect, page, 0, 191);
	}
	else if ((a2 & VAR_HIRES) && (a2 & VAR_MIXED))
	{
		apple2_hires_draw(bitmap, cliprect, page, 0, 159);
		apple2_text_draw(bitmap, cliprect, page, 160, 191);
	}
	else if (a2 & VAR_HIRES)
	{
		apple2_hires_draw(bitmap, cliprect, page, 0, 191);
	}
	else if (a2 & VAR_MIXED)
	{
		apple2_lores_draw(bitmap, cliprect, page, 0, 159);
		apple2_text_draw(bitmap, cliprect, page, 160, 191);
	}
	else
	{
		apple2_lores_draw(bitmap, cliprect, page, 0, 191);
	}
}

void apple2_video_touch(offs_t offset)
{
	profiler_mark(PROFILER_VIDEOTOUCH);
	if (offset >= text_videobase)
		tilemap_mark_tile_dirty(text_tilemap, offset - text_videobase);
	if (offset >= dbltext_videobase)
		tilemap_mark_tile_dirty(dbltext_tilemap, offset - dbltext_videobase);
	if (offset >= lores_videobase)
		tilemap_mark_tile_dirty(lores_tilemap, offset - text_videobase);
	profiler_mark(PROFILER_END);
}
